# POC（Proof of Concept）设计与实现说明

## 一、应用输入

### 1. 腹腔镜实时视频流
作为主要输入，系统接收来自达芬奇手术操作台的腹腔镜视频流，用于后续的特征识别与模型变形驱动。  
**Q:** 此POC阶段使用本地MP4视频，是否可行

### 2. 高精度3D模型（STL格式）
术前通过mpMRI影像分割，获得前列腺、肿瘤、尿道、神经血管束等结构的高精度三维模型，导出为STL格式。

### 3. 手术参数与标注数据
包括医生手动标注的关键解剖点、病变位置（前/后/左/右/双侧等）、器械运动轨迹等。  
**Q:** 是否已经有软件可以实现标注？
- **是：**
    - **Q:** 直接与stl文件一同导出
        - **是：** 此步骤忽略，使用第2步的stl文件
        - **否：** 提供标注文件，再次导入
- **否：** POC提供标注功能，将标注文件应用到基于STL创建的模型中，并且生成标注文件（JSON格式）

---

## 二、应用输出

### 增强现实（AR）导航视图（POC阶段通过WEB页面实现展示）
将实时变形后的3D模型叠加到腹腔镜视频流上，通过TilePro等技术显示在手术台控制台，实现AR导航。  
**Q:** 是否已有TilePro或其它AR导航软件
- **是：** 输出到已有软件进行展示
- **否：** 此POC提供AR导航功能，将变形后的3D模型与腹腔镜视频流进行融合。
POC阶段通过WEB展示

### 实时变形参数
系统输出当前模型的变形参数（即在术前模型创建和术中模型推测时使用的参数），供医生参考。

---

## 三、生物力学模型的创建

三种模型的选择：
1. **简化有限元模型（FEM）：** 传统物理建模方法，通过网格和物理参数（如弹性模量）直接计算变形。
2. **质点-弹簧模型：** 另一种经典物理建模方法，通过节点和弹簧连接模拟弹性和变形。
3. **EndoNeRF（[参考项目](https://med-air.github.io/EndoNeRF/)）：** 基于神经网络的隐式建模方法，强调数据驱动和物理约束的结合，属于新一代的混合建模方法。

**Q:** EndoNeRF是否可以应用到我们的模型创建步骤中：
- **是：** POC阶段可优先借鉴其“数据驱动+物理约束”的混合思路（不训练）。即：
    - 以STL模型为基础，构建简化的有限元或质点-弹簧模型，保证物理可信度。
    - 同时引入神经网络（如MLP/CNN）辅助预测变形参数，提升实时性和自适应能力。
- **否：** 不使用

> 1和2无需训练，直接物理建模  
> 3需要训练神经网络（当前POC阶段不训练）

在输入的高精度3D模型（STL）基础上，构建简化的生物力学模型。

- 目的是保证模型变形时具备物理可信度（如体积保持、弹性约束），而非复杂的实时物理仿真。
- 赋予模型基本的弹性和体积约束属性。

**物理属性设定（提供参数）**
- 设定弹性模量、体积保持系数等参数。
- 支持不同方向（如前/后/左/右）拉伸和弯曲的物理响应。

---

## 四、模型变形处理算法

### 4.1 算法的选择
- 基于控制点的自由变形（FFD, Free-Form Deformation）（POC阶段推荐）
- 数据驱动的参数预测（CNN）
- 端到端神经网络变形（训练复杂，POC阶段不推荐）

### 4.2 数据驱动的参数预测（CNN）算法的实现（可选）

1. **术前：** 训练卷积神经网络（CNN），输入为已有的腹腔镜视频文件（MP4）和标注数据。保存训练好的模型。

    - 训练后的模型具有的基本能力：（可补充）
        - CNN自动识别关键解剖特征、器械位置，输出描述器官变形的高阶参数（如整体拉伸、弯曲角度/方向）。
        - 物理模型驱动变形

2. **术中：** 通过第三步创建的模型，结合训练后的CNN模型数据，
    - 变形参数（如“拉伸10%”、“弯曲15度”）作为虚拟“力”输入到生物力学模型。（提供参数）
    - 物理模型根据自身属性计算出最终的、物理可信的变形结果，避免不真实的几何变换。
    - 实时配准与追踪（不在POC范围）

        - 初始通过刚性配准（人工辅助或无标记点校准）将虚拟模型对齐到真实器官。
        - 手术过程中，系统持续追踪器官表面特征和器械运动，动态调整模型变形。

**Q:** 是否可以使用FFD做为POC阶段的算法
